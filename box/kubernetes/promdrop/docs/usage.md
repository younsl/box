# Usage Guide

This guide provides detailed instructions on how to use Promdrop to generate Prometheus metric relabel configurations.

## Prerequisites

Before using Promdrop, you need to analyze your Prometheus metrics to identify unused metrics for each job.

### Analyzing Prometheus Metrics

Analyze your Prometheus metrics using the [Grafana Mimirtool](https://grafana.com/docs/mimir/latest/manage/tools/mimirtool/) to recognize unused metrics for each job. 

> **Important**: This step is crucial. `promdrop` relies entirely on the analysis results within the `prometheus-metrics.json` file generated by `mimirtool analyze prometheus`. Without a properly generated input file reflecting your environment's metric usage, `promdrop` cannot function and will produce no meaningful outputs.

For detailed guidance on using mimirtool, refer to [this article by David Calvert](https://0xdc.me/blog/how-to-find-unused-prometheus-metrics-using-mimirtool/).

## Workflow Architecture

![Workflow Architecture for Promdrop](./assets/2.png)

## Command Line Usage

### Basic Syntax

```bash
./promdrop --file <prometheus-metrics.json> [flags]
```

### Available Flags

- `-f`, `--file <string>`: (Required) Input `prometheus-metrics.json` file path.
- `-t`, `--txt-output-dir <string>`: Output directory for per-job `.txt` metric lists (default: `unused`).
- `-o`, `--output <string>`: Output file for combined YAML configuration (default: `combined_relabel_configs.yaml`).
- `-h`, `--help`: Show help message.

### Examples

#### Basic Usage

Generate relabel configurations with default output settings:

```bash
./promdrop --file prometheus-metrics.json
```

#### Custom Output File

Specify a custom output file name:

```bash
./promdrop --file prometheus-metrics.json --output my_relabel_configs.yaml
```

#### Custom Text Output Directory

Specify a custom directory for text output files:

```bash
./promdrop --file prometheus-metrics.json --txt-output-dir metrics_analysis
```

#### Complete Example

Using all available options:

```bash
./promdrop \
  --file prometheus-metrics.json \
  --output combined_relabel_configs.yaml \
  --txt-output-dir unused_metrics
```

## Next Steps

After generating the configuration files, see the [Output Configuration Guide](./output-configuration.md) for instructions on how to integrate the generated configurations into your Prometheus setup.