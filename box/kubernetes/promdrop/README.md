<img src="./docs/assets/1.webp" alt="Promdrop" width="64" height="64">

[![Release](https://img.shields.io/github/v/release/younsl/promdrop?style=flat-square&color=black&logo=github&logoColor=white)](https://github.com/younsl/promdrop/releases)
[![Container Image](https://img.shields.io/github/v/release/younsl/promdrop?style=flat-square&color=black&logo=docker&logoColor=white&label=ghcr.io)](https://github.com/users/younsl/packages/container/package/promdrop)
[![Go Version](https://img.shields.io/badge/Go-1.25-blue?style=flat-square&color=black&logo=go&logoColor=white)](https://golang.org/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg?style=flat-square&color=black)](https://opensource.org/licenses/MIT)

# Promdrop

A Go CLI tool to generate Prometheus `metric_relabel_configs` for dropping unused metrics.

promdrop parses the `additional_metric_counts` section from a `prometheus-metrics.json` file and creates YAML configurations to filter out these metrics per job.

## Background

### Why Promdrop?

Managing Prometheus metrics at scale can be challenging, especially for Site Reliability Engineers (SREs), DevOps Engineers, and other Observability practitioners. Over time, environments accumulate unused metrics, consuming resources and potentially impacting performance. Identifying these metrics and manually crafting `metric_relabel_configs` to drop them for each job is tedious and error-prone.

`Promdrop` was created to simplify this process for those managing observability platforms. By analyzing metric usage data (like that produced by `mimirtool analyze prometheus`), it automatically generates the necessary `scrape_configs` with `metric_relabel_configs` to efficiently drop unused metrics. This helps streamline Prometheus configuration management and optimize the operational environment.

## Quick Start

Build and run Promdrop:

```bash
# Build from source
make build

# Run with your metrics file
./promdrop --file prometheus-metrics.json
```

For detailed installation instructions, see the [Installation Guide](./docs/installation.md).

## Prerequisites

**Analyze your Prometheus metrics** using [Grafana Mimirtool](https://grafana.com/docs/mimir/latest/manage/tools/mimirtool/) to identify unused metrics:

```bash
mimirtool analyze prometheus --address=http://prometheus:9090 --output=prometheus-metrics.json
```

> [!IMPORTANT]
> Promdrop requires the `prometheus-metrics.json` file generated by mimirtool. Without this file, promdrop cannot function.

For detailed usage instructions and examples, see the [Usage Guide](./docs/usage.md).

## Output

Promdrop generates:
1. **YAML configuration** (`combined_relabel_configs.yaml`) - Prometheus scrape configs with metric relabel rules
2. **Text files** - Per-job unused metric lists and summary statistics

For detailed information about output files and integration instructions, see the [Output Configuration Guide](./docs/output-configuration.md).

## Documentation

- [Installation Guide](./docs/installation.md) - How to build and install Promdrop
- [Usage Guide](./docs/usage.md) - Detailed usage instructions and examples  
- [Output Configuration](./docs/output-configuration.md) - Understanding and integrating generated configurations
- [Branching Strategy](./docs/branching-strategy.md) - Git branching workflow and release management

## License

This project is licensed under the MIT License. See the [LICENSE](LICENSE) file for details.
